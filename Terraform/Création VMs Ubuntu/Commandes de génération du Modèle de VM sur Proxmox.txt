# installing libguestfs-tools only required once, prior to first run
sudo apt update -y
sudo apt install libguestfs-tools -y

# download a debian cloud-init disk image:

wget https://cloud-images.ubuntu.com/releases/20.04/release/ubuntu-20.04-server-cloudimg-amd64.img

sudo virt-customize -a ubuntu-20.04-server-cloudimg-amd64.img --install qemu-guest-agent
sudo virt-customize -a ubuntu-20.04-server-cloudimg-amd64.img --root-password password:fabrice
sudo qm create 1000 --name "ubuntu-2004-init" --memory 1024 --cores 1 --net0 virtio,bridge=vmbr0

sudo qm importdisk 1000 ubuntu-20.04-server-cloudimg-amd64.img local-lvm
sudo qm set 1000 --scsihw virtio-scsi-pci --scsi0 local-lvm:vm-1000-disk-0
sudo qm set 1000 --boot c --bootdisk scsi0
sudo qm set 1000 --ide2 local-lvm:cloudinit
sudo qm set 1000 --serial0 socket --vga serial0
sudo qm set 1000 --agent enabled=1
sudo qm template 1000



